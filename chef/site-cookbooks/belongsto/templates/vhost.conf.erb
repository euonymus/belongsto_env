ServerName <%= @params[:server_name] %>

<VirtualHost *:80>
  DocumentRoot <%= @params[:docroot] %>

  RewriteEngine On

  <Directory <%= @params[:docroot] %>>
    Options FollowSymLinks
    AllowOverride All
  </Directory>

  <Location />
    Require all granted
<% if node.chef_environment == 'virtualbox' then %>
    # Local
    Require ip 192.168.33.1
<% end %>
  </Location>

  <LocationMatch /(webroot|css|img|js|feed/(autotweet_tw|autotweet_at|autofbpost|mediagene)|users/login)>
    Require all granted
  </LocationMatch>

  LogLevel info
  ErrorLog <%= @node[:apache][:log_dir] %>/<%= @params[:name] %>-error.log
  CustomLog <%= @node[:apache][:log_dir] %>/<%= @params[:name] %>-access.log combined
</VirtualHost>